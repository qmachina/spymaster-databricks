{
  "name": "rt__mbo_raw_to_bronze",
  "description": "Real-time streaming: Event Hubs to Bronze with DLQ, watermarking, and rate limiting",
  "continuous": {
    "pause_status": "UNPAUSED"
  },
  "max_concurrent_runs": 1,
  "email_notifications": {
    "on_failure": [
      "logan@qmachina.com"
    ],
    "on_streaming_backlog_exceeded": [
      "logan@qmachina.com"
    ]
  },
  "notification_settings": {
    "no_alert_for_skipped_runs": true
  },
  "git_source": {
    "git_url": "https://github.com/qmachina/spymaster-databricks",
    "git_provider": "gitHub",
    "git_branch": "main"
  },
  "tasks": [
    {
      "task_key": "mbo_raw_to_bronze",
      "notebook_task": {
        "notebook_path": "streaming/rt__mbo_raw_to_bronze",
        "source": "GIT",
        "base_parameters": {
          "eventhub_namespace": "ehnspymasterdevoxxrlojskvxey",
          "eventhub_name": "mbo_raw",
          "consumer_group": "databricks_bronze",
          "catalog": "bronze",
          "schema_name": "default",
          "table_name": "mbo_stream",
          "dlq_table_name": "mbo_stream_dlq",
          "checkpoint_base": "abfss://lake@spymasterdevlakeoxxrlojs.dfs.core.windows.net/checkpoints",
          "max_files_per_trigger": "1000",
          "max_bytes_per_trigger": "1g"
        }
      },
      "new_cluster": {
        "spark_version": "16.4.x-scala2.12",
        "node_type_id": "Standard_D2ads_v6",
        "num_workers": 0,
        "spark_conf": {
          "spark.sql.streaming.stateStore.providerClass": "com.databricks.sql.streaming.state.RocksDBStateStoreProvider",
          "spark.sql.streaming.stateStore.rocksdb.changelogCheckpointing.enabled": "true",
          "spark.sql.execution.arrow.pyspark.enabled": "true",
          "spark.databricks.adaptive.autoOptimizeShuffle.enabled": "true",
          "spark.databricks.delta.autoOptimize.optimizeWrite": "true",
          "spark.databricks.delta.autoOptimize.autoCompact": "true"
        },
        "custom_tags": {
          "Environment": "Production",
          "Project": "Spymaster",
          "Owner": "DataEng",
          "Layer": "Bronze",
          "Type": "Streaming",
          "CostCenter": "RealTime"
        },
        "enable_elastic_disk": true,
        "data_security_mode": "SINGLE_USER"
      },
      "libraries": [
        {
          "maven": {
            "coordinates": "com.microsoft.azure:azure-eventhubs-spark_2.12:2.3.22"
          }
        }
      ],
      "timeout_seconds": 0
    }
  ],
  "tags": {
    "Environment": "Production",
    "Project": "Spymaster",
    "Pipeline": "RealTime",
    "Owner": "DataEng"
  }
}
