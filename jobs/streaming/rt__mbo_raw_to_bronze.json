{
  "name": "rt__mbo_raw_to_bronze",
  "description": "Real-time streaming: Event Hubs to Bronze with DLQ, watermarking, and rate limiting",
  "continuous": {
    "pause_status": "UNPAUSED"
  },
  "max_concurrent_runs": 1,
  "email_notifications": {
    "on_failure": ["logan@qmachina.com"],
    "on_streaming_backlog_exceeded": ["logan@qmachina.com"]
  },
  "notification_settings": {
    "alert_on_last_attempt": true,
    "no_alert_for_skipped_runs": true
  },
  "tasks": [
    {
      "task_key": "mbo_raw_to_bronze",
      "notebook_task": {
        "notebook_path": "/Shared/spymaster/rt__mbo_raw_to_bronze",
        "base_parameters": {
          "eventhub_namespace": "ehnspymasterdevoxxrlojskvxey",
          "eventhub_name": "mbo_raw",
          "consumer_group": "databricks_bronze",
          "catalog": "spymaster",
          "schema_name": "bronze",
          "table_name": "mbo_stream",
          "dlq_table_name": "mbo_stream_dlq",
          "checkpoint_base": "abfss://lake@spymasterdevlakeoxxrlojs.dfs.core.windows.net/checkpoints",
          "max_files_per_trigger": "1000",
          "max_bytes_per_trigger": "1g"
        },
        "source": "WORKSPACE"
      },
      "new_cluster": {
        "spark_version": "17.0.x-scala2.12",
        "node_type_id": "Standard_D4s_v3",
        "autoscale": {
          "min_workers": 2,
          "max_workers": 8
        },
        "spark_conf": {
          "spark.sql.streaming.stateStore.providerClass": "com.databricks.sql.streaming.state.RocksDBStateStoreProvider",
          "spark.sql.streaming.stateStore.rocksdb.changelogCheckpointing.enabled": "true",
          "spark.sql.execution.arrow.pyspark.enabled": "true",
          "spark.databricks.adaptive.autoOptimizeShuffle.enabled": "true",
          "spark.databricks.delta.autoOptimize.optimizeWrite": "true",
          "spark.databricks.delta.autoOptimize.autoCompact": "true"
        },
        "custom_tags": {
          "Environment": "Production",
          "Project": "Spymaster",
          "Owner": "DataEng",
          "Layer": "Bronze",
          "Type": "Streaming",
          "CostCenter": "RealTime"
        },
        "enable_elastic_disk": true,
        "data_security_mode": "SINGLE_USER"
      },
      "libraries": [
        {
          "maven": {
            "coordinates": "com.microsoft.azure:azure-eventhubs-spark_2.12:2.3.26"
          }
        }
      ],
      "timeout_seconds": 0,
      "retry_policy": {
        "max_retries": 3,
        "interval_ms": 30000,
        "retry_on_timeout": true
      }
    }
  ],
  "tags": {
    "Environment": "Production",
    "Project": "Spymaster",
    "Pipeline": "RealTime",
    "Owner": "DataEng"
  }
}
